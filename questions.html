<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.2/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-database-compat.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }
        .question {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
        }
        .question-text {
            flex: 1;
            margin-bottom: 10px;
        }
        .answer, .model-answer {
            margin-top: 10px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 3px;
            display: none;
        }
        .answer.show, .model-answer.show {
            display: block;
        }
        button {
            margin: 5px 5px 5px 0;
            padding: 8px 15px;
            cursor: pointer;
            border: 1px solid #333;
            background: white;
            border-radius: 3px;
        }
        button:hover {
            background: #f0f0f0;
        }
        .edit-btn, .delete-btn {
            padding: 5px 10px;
            font-size: 12px;
        }
        .delete-btn {
            background: #ffebee;
        }
        .add-btn {
            font-size: 20px;
            padding: 10px 20px;
            margin: 20px 0;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 20px;
            max-width: 600px;
            border-radius: 5px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal input, .modal textarea, .modal select {
            width: 100%;
            margin: 10px 0;
            padding: 8px;
            box-sizing: border-box;
        }
        .modal textarea {
            min-height: 100px;
            font-family: monospace;
        }
        .mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
        .config-section {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .config-section input {
            font-size: 12px;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="mode-toggle">
        <button onclick="toggleMode()">–†–µ–∂–∏–º: <span id="mode-text">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</span></button>
    </div>

    <div id="content"><div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div></div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <h2 id="modal-title">–î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</h2>
            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
            <select id="category">
                <option value="good">–•–û–†–û–®–ò–ï –í–û–ü–†–û–°–´</option>
                <option value="simple">–ü–†–û–°–¢–´–ï –í–û–ü–†–û–°–´</option>
                <option value="needsWork">–í–û–ü–†–û–°–´, –¢–†–ï–ë–£–Æ–©–ò–ï –î–û–†–ê–ë–û–¢–ö–ò</option>
            </select>
            <label>–í–æ–ø—Ä–æ—Å:</label>
            <textarea id="question-text"></textarea>
            <label>–û—Ç–≤–µ—Ç (markdown):</label>
            <textarea id="answer-text"></textarea>
            <label>–û—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏ (markdown):</label>
            <textarea id="model-answer-text"></textarea>
            <button onclick="saveQuestion()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script>
        let isEditMode = true;
        let editingKey = null;
        let database = null;
        
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase - –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ—é!
        const firebaseConfig = {
            apiKey: "AIzaSyCAnPjFE2yhHcnOoaVo7Q0RJ1hA-F4GEDc",
            authDomain: "some-questions-econ.firebaseapp.com",
            databaseURL: "https://some-questions-econ-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "some-questions-econ",
            storageBucket: "some-questions-econ.firebasestorage.app",
            messagingSenderId: "367035246315",
            appId: "1:367035246315:web:3f66c9dcf58756e86080ae"
        };
        
        let localData = {
            good: [
                {
                    question: "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–µ–∫—É—Ä—Å–∏—è?",
                    answer: "–†–µ–∫—É—Ä—Å–∏—è - —ç—Ç–æ –∫–æ–≥–¥–∞ **—Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç —Å–∞–º—É —Å–µ–±—è**. –í–∞–∂–Ω–æ –Ω–∞–ª–∏—á–∏–µ –±–∞–∑–æ–≤–æ–≥–æ —Å–ª—É—á–∞—è –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏.",
                    modelAnswer: "–†–µ–∫—É—Ä—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ *—Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤*. –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –±–∞–∑–æ–≤–æ–≥–æ —Å–ª—É—á–∞—è."
                }
            ],
            simple: [
                {
                    question: "–ß—Ç–æ —Ç–∞–∫–æ–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è?",
                    answer: "–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è - —ç—Ç–æ *–∏–º–µ–Ω–æ–≤–∞–Ω–Ω–æ–µ –º–µ—Å—Ç–æ –≤ –ø–∞–º—è—Ç–∏* –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.",
                    modelAnswer: "–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Ö—Ä–∞–Ω–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã."
                }
            ],
            needsWork: [
                {
                    question: "–û–±—ä—è—Å–Ω–∏ –∫–≤–∞–Ω—Ç–æ–≤—É—é —Ñ–∏–∑–∏–∫—É",
                    answer: "–¢—Ä–µ–±—É–µ—Ç—Å—è –±–æ–ª–µ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤–æ–ø—Ä–æ—Å.",
                    modelAnswer: "–≠—Ç–æ –æ—á–µ–Ω—å —à–∏—Ä–æ–∫–∞—è —Ç–µ–º–∞, –Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å —á—Ç–æ –∏–º–µ–Ω–Ω–æ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç."
                }
            ]
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            
            console.log('Firebase initialized');
            
            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ
            database.ref('questions').on('value', (snapshot) => {
                console.log('Data received from Firebase');
                const data = snapshot.val();
                if (data) {
                    localData = data;
                    render();
                } else {
                    console.log('Database empty, uploading initial data');
                    // –ï—Å–ª–∏ –±–∞–∑–∞ –ø—É—Å—Ç–∞—è, –∑–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    database.ref('questions').set(localData).then(() => {
                        console.log('Initial data uploaded');
                        render();
                    });
                }
            }, (error) => {
                console.error('Firebase read error:', error);
                document.getElementById('content').innerHTML = '<div class="error">–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –∏–∑ Firebase: ' + error.message + '. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ Firebase Console.</div>';
            });
        } catch (error) {
            console.error('Firebase init error:', error);
            document.getElementById('content').innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase: ' + error.message + '</div>';
        }

        function initFirebase() {
            const config = {
                apiKey: document.getElementById('apiKey').value,
                authDomain: document.getElementById('authDomain').value,
                databaseURL: document.getElementById('databaseURL').value,
                projectId: document.getElementById('projectId').value,
                storageBucket: document.getElementById('storageBucket').value,
                messagingSenderId: document.getElementById('messagingSenderId').value,
                appId: document.getElementById('appId').value
            };

            try {
                firebase.initializeApp(config);
                database = firebase.database();
                useFirebase = true;
                document.getElementById('config-modal').style.display = 'none';
                
                // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ
                database.ref('questions').on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        localData = data;
                    }
                    render();
                });
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase: ' + error.message);
            }
        }

        function useLocalMode() {
            useFirebase = false;
            document.getElementById('config-modal').style.display = 'none';
            render();
        }

        function render() {
            const content = document.getElementById('content');
            content.innerHTML = '';

            const categories = [
                { key: 'good', title: '–•–û–†–û–®–ò–ï –í–û–ü–†–û–°–´' },
                { key: 'simple', title: '–ü–†–û–°–¢–´–ï –í–û–ü–†–û–°–´' },
                { key: 'needsWork', title: '–í–û–ü–†–û–°–´, –¢–†–ï–ë–£–Æ–©–ò–ï –î–û–†–ê–ë–û–¢–ö–ò' }
            ];

            categories.forEach(cat => {
                const section = document.createElement('div');
                section.innerHTML = `<h1>${cat.title}</h1>`;
                
                const items = localData[cat.key] || [];
                items.forEach((item, index) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question';
                    
                    questionDiv.innerHTML = `
                        <div class="question-header">
                            <div class="question-text">${escapeHtml(item.question)}</div>
                            ${isEditMode ? `
                                <div>
                                    <button class="edit-btn" onclick="editQuestion('${cat.key}', ${index})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                    <button class="delete-btn" onclick="deleteQuestion('${cat.key}', ${index})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                                </div>
                            ` : ''}
                        </div>
                        <button onclick="toggleAnswer(this)">–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç</button>
                        <div class="answer">${marked.parse(item.answer)}</div>
                        <button onclick="toggleModelAnswer(this)">–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏</button>
                        <div class="model-answer">${marked.parse(item.modelAnswer)}</div>
                    `;
                    
                    section.appendChild(questionDiv);
                });

                if (isEditMode) {
                    const addBtn = document.createElement('button');
                    addBtn.className = 'add-btn';
                    addBtn.textContent = '+ –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å';
                    addBtn.onclick = () => openModal(cat.key);
                    section.appendChild(addBtn);
                }

                content.appendChild(section);
            });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function toggleAnswer(btn) {
            const answer = btn.nextElementSibling;
            answer.classList.toggle('show');
            btn.textContent = answer.classList.contains('show') ? '–°–∫—Ä—ã—Ç—å –æ—Ç–≤–µ—Ç' : '–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç';
        }

        function toggleModelAnswer(btn) {
            const answer = btn.nextElementSibling;
            answer.classList.toggle('show');
            btn.textContent = answer.classList.contains('show') ? '–°–∫—Ä—ã—Ç—å –æ—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏' : '–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏';
        }

        function openModal(category) {
            document.getElementById('modal').style.display = 'block';
            document.getElementById('modal-title').textContent = '–î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å';
            document.getElementById('category').value = category;
            document.getElementById('question-text').value = '';
            document.getElementById('answer-text').value = '';
            document.getElementById('model-answer-text').value = '';
            editingKey = null;
        }

        function editQuestion(category, index) {
            const item = localData[category][index];
            document.getElementById('modal').style.display = 'block';
            document.getElementById('modal-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å';
            document.getElementById('category').value = category;
            document.getElementById('question-text').value = item.question;
            document.getElementById('answer-text').value = item.answer;
            document.getElementById('model-answer-text').value = item.modelAnswer;
            editingKey = `${category}-${index}`;
        }

        function saveQuestion() {
            const category = document.getElementById('category').value;
            const question = document.getElementById('question-text').value;
            const answer = document.getElementById('answer-text').value;
            const modelAnswer = document.getElementById('model-answer-text').value;

            if (!question || !answer || !modelAnswer) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            if (!localData[category]) {
                localData[category] = [];
            }

            if (editingKey === null) {
                localData[category].push({ question, answer, modelAnswer });
            } else {
                const [cat, idx] = editingKey.split('-');
                localData[cat][idx] = { question, answer, modelAnswer };
            }

            if (database) {
                database.ref('questions').set(localData);
            }

            closeModal();
            render();
        }

        function deleteQuestion(category, index) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å?')) {
                localData[category].splice(index, 1);
                
                if (database) {
                    database.ref('questions').set(localData);
                } else {
                    render();
                }
            }
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        function toggleMode() {
            isEditMode = !isEditMode;
            document.getElementById('mode-text').textContent = isEditMode ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ' : '–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è';
            render();
        }
    </script>
</body>
</html>
